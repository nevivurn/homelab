apiVersion: v1
kind: Pod
metadata:
  name: chrony
  annotations:
    checksum/config: {{ chrony_config.checksum }}
spec:
  hostNetwork: true
  containers:
    - name: chrony
      securityContext:
        allowPrivilegeEscalation: false
        capabilities:
          drop: [ALL]
        readOnlyRootFilesystem: true
        runAsUser: {{ chrony_user.uid }}
        runAsGroup: {{ chrony_group.gid }}
        runAsNonRoot: true
      image: "{{ chrony_image }}:{{ chrony_version }}"
      args: ["-f", "{{ chrony_config_dir }}/chrony.conf"]
      ports:
        - name: ntp
          containerPort: 123
          protocol: UDP
      volumeMounts:
        - name: config
          mountPath: /etc/chrony
        - name: run
          mountPath: /var/run/chrony
  volumes:
    - name: config
      hostPath:
        type: Directory
        path: {{ chrony_config_dir }}
    - name: run
      emptyDir:
        medium: Memory
